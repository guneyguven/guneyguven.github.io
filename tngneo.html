<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Tango Neo ‚Äî Tek Dosya</title>
<style>
  :root{
    --bg1:#0f1226; --bg2:#1a1f4b; --acc:#6de6ff; --acc2:#ff6de1; --good:#59ffa1; --bad:#ff6b6b; --text:#e9ecff;
    --panel: rgba(255,255,255,0.06); --panel-2: rgba(255,255,255,0.12); --shadow: 0 10px 30px rgba(0,0,0,0.35);
  }
  html,body {height:100%; margin:0; background: radial-gradient(1200px 800px at 70% 20%, var(--bg2), transparent 60%), 
                                   radial-gradient(900px 900px at 10% 90%, #112, transparent 60%), linear-gradient(180deg, #0a0d1f, var(--bg1));
             color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
  .wrap {
    position:relative; height:100%; display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .frame {
    position:relative; width:min(92vw, 520px); aspect-ratio: 9/16; border-radius:24px;
    box-shadow: var(--shadow); background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
    overflow: hidden; backdrop-filter: blur(6px);
  }
  canvas { width:100%; height:100%; display:block; background: linear-gradient(180deg, #0b0f22 0%, #0a0d1f 100%); }
  /* HUD */
  .hud { position:absolute; inset:0; pointer-events:none; }
  .topbar { position:absolute; top:10px; left:10px; right:10px; display:flex; gap:8px; align-items:center; }
  .chip {
    pointer-events:auto;
    padding:8px 12px; border-radius:14px; background:var(--panel); border:1px solid var(--panel-2);
    display:inline-flex; align-items:center; gap:8px; font-weight:600; backdrop-filter:saturate(140%) blur(4px);
  }
  .spacer{flex:1;}
  .btn {
    pointer-events:auto; cursor:pointer; user-select:none;
    padding:10px 14px; border-radius:12px; font-weight:700;
    border:1px solid var(--panel-2); background:linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
    transition: transform .08s ease;
  }
  .btn:active { transform: translateY(1px) scale(0.98); }
  .btn--primary { border-color: transparent; background:
      radial-gradient(120% 120% at 0% 0%, rgba(255,255,255,0.25), transparent 40%),
      linear-gradient(90deg, var(--acc), var(--acc2)); color:#08111a; box-shadow: 0 6px 24px rgba(109,230,255,0.25); }
  .meter{display:inline-flex; gap:6px; align-items:center;}
  .dot{width:8px; height:8px; border-radius:50%; background: #3a3e66; outline:1px solid rgba(255,255,255,0.12);}
  .dot.filled{background: var(--acc);}
  /* Center overlays */
  .center {
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;
    text-align:center; padding:18px;
  }
  .panel {
    pointer-events:auto; max-width:85%; border-radius:18px; padding:20px 18px; 
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); 
    border:1px solid var(--panel-2); box-shadow: var(--shadow);
  }
  h1{margin:0 0 6px; font-size:28px; letter-spacing:.5px;}
  p{margin:6px 0 12px; opacity:.9}
  .row{display:flex; gap:8px; flex-wrap:wrap; justify-content:center;}
  .kbd{padding:6px 8px; border-radius:8px; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); font-weight:700}
  .foothint{position:absolute; bottom:12px; left:0; right:0; text-align:center; opacity:.7; font-size:12px;}
  .toast{ position:absolute; left:50%; transform:translateX(-50%); bottom:16px; padding:10px 14px; border-radius:12px;
          background:rgba(0,0,0,0.35); border:1px solid rgba(255,255,255,0.15); backdrop-filter: blur(4px); pointer-events:none;}
  .stepline {
    position:absolute; inset:0; pointer-events:none;
    background: repeating-linear-gradient(90deg, transparent 0 32%, rgba(255,255,255,0.03) 32% 34%, transparent 34% 66%, rgba(255,255,255,0.03) 66% 68%, transparent 68% 100%);
    mix-blend-mode: screen;
  }
  .btn-inline { display:inline-flex; align-items:center; gap:8px;}
  .muted{opacity:.8}
</style>
</head>
<body>
<div class="wrap">
  <div class="frame">
    <canvas id="game" width="360" height="640" aria-label="Tango Neo oyun tuvali"></canvas>

    <!-- HUD -->
    <div class="hud">
      <div class="topbar">
        <div class="chip" id="scoreChip">Skor: <span id="scoreVal">0</span></div>
        <div class="chip">Combo: <span id="comboVal">x1</span></div>
        <div class="chip meter" title="Dash G√ºc√º">
          <span class="dot" id="d0"></span><span class="dot" id="d1"></span><span class="dot" id="d2"></span>
        </div>
        <div class="spacer"></div>
        <button class="btn" id="muteBtn" aria-label="Sesi a√ß/kapat">üîà</button>
        <button class="btn" id="pauseBtn" aria-label="Duraklat">‚è∏</button>
      </div>

      <div class="center" id="menu">
        <div class="panel">
          <h1>Tango Neo</h1>
          <p class="muted">3 ≈üerit, akƒ±≈ükan hareket, <b>Dash</b> ile zamana h√ºkmet!</p>
          <div class="row" style="margin:10px 0 14px">
            <button class="btn btn--primary" id="startBtn">Ba≈üla</button>
            <button class="btn" id="howBtn">Nasƒ±l Oynanƒ±r?</button>
          </div>
          <div class="muted">En y√ºksek skor: <span id="bestVal">0</span></div>
        </div>
      </div>

      <div class="center" id="how" hidden>
        <div class="panel">
          <h1>Kontroller</h1>
          <p><span class="kbd">A</span>/<span class="kbd">‚Üê</span> sol, 
             <span class="kbd">D</span>/<span class="kbd">‚Üí</span> saƒü, 
             <span class="kbd">W</span>/<span class="kbd">‚Üë</span> veya <span class="kbd">Space</span> = <b>Dash</b></p>
          <p>Mobil: sola/saƒüa <b>kaydƒ±r</b>, yukarƒ± <b>kaydƒ±r</b> = Dash</p>
          <div class="row"><button class="btn" id="backBtn">Geri</button></div>
        </div>
      </div>

      <div class="center" id="gameover" hidden>
        <div class="panel">
          <h1>Oyun Bitti</h1>
          <p>Skorun: <b id="finalScore">0</b></p>
          <p class="muted">En y√ºksek skor: <b id="bestScore">0</b></p>
          <div class="row">
            <button class="btn btn--primary" id="retryBtn">Tekrar</button>
            <button class="btn" id="shareBtn">Payla≈ü</button>
          </div>
        </div>
      </div>

      <div class="toast" id="toast" hidden>Hazƒ±r!</div>
    </div>

    <!-- Subtle lane lines -->
    <div class="stepline" aria-hidden="true"></div>
  </div>
</div>

<script>
(() => {
  // ===== Helpers
  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
  const lerp = (a,b,t)=>a+(b-a)*t;
  const rand = (a,b)=>a+Math.random()*(b-a);
  const now = ()=>performance.now();

  // ===== Canvas + DPR scaling
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  function fitCanvas(){
    const dpr = Math.max(1, Math.floor(window.devicePixelRatio||1));
    const w = 360, h = 640; // logical resolution
    cvs.width = w * dpr; cvs.height = h * dpr;
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  fitCanvas(); addEventListener('resize', fitCanvas);

  // ===== Game State
  const STATE = { MENU:0, RUN:1, PAUSE:2, OVER:3 };
  let state = STATE.MENU;

  // ===== UI
  const $ = sel => document.querySelector(sel);
  const menu = $('#menu'), over = $('#gameover'), how = $('#how');
  const startBtn = $('#startBtn'), howBtn = $('#howBtn'), backBtn = $('#backBtn');
  const pauseBtn = $('#pauseBtn'), retryBtn = $('#retryBtn'), shareBtn = $('#shareBtn'), muteBtn = $('#muteBtn');
  const scoreVal = $('#scoreVal'), comboVal = $('#comboVal');
  const finalScore = $('#finalScore'), bestScore = $('#bestScore'), bestVal = $('#bestVal');
  const toast = $('#toast');
  const dDots = [$('#d0'), $('#d1'), $('#d2')];

  let best = +localStorage.getItem('tango_best_v2')||0;
  bestVal.textContent = best;

  function show(el){ el.hidden=false; }
  function hide(el){ el.hidden=true; }
  function setToast(text, t=1200){ toast.textContent=text; toast.hidden=false; clearTimeout(setToast._t); setToast._t=setTimeout(()=>toast.hidden=true,t); }

  // ===== Audio (tiny beeps, no external assets)
  let audioOn = true;
  let ac;
  function beep(freq=440, dur=0.08, type='sine', gain=0.08){
    if(!audioOn) return;
    try{
      ac = ac || new (window.AudioContext||window.webkitAudioContext)();
      const o = ac.createOscillator(), g = ac.createGain();
      o.type=type; o.frequency.value=freq;
      g.gain.value=gain; o.connect(g); g.connect(ac.destination);
      o.start(); o.stop(ac.currentTime + dur);
    }catch(e){}
  }

  // ===== World
  const lanes = [0.18, 0.5, 0.82]; // x as width ratio
  const W = 360, H = 640;
  let timeScale = 1;
  let baseSpeed, spawnT, orbT, score, combo, comboT, playingSince;
  let objects, orbs, particles;

  // Player
  const player = {
    lane: 1, x: W*lanes[1], y: H*0.78, t:0,
    w: 34, h: 46, col:"#e6f2ff",
    targetLane: 1,
    dash: 3, dashMax:3, dashCD: 0, inv:0
  };

  function reset(){
    baseSpeed = 120; // px/s
    spawnT = 0; orbT = 0; score = 0; combo = 1; comboT = 0;
    timeScale = 1; objects=[]; orbs=[]; particles=[];
    player.lane=1; player.targetLane=1; player.x=W*lanes[1]; player.y=H*0.78;
    player.dash=3; player.dashCD=0; player.inv=0;
    playingSince = now();
    updateHUD();
    refreshDashDots();
  }

  function refreshDashDots(){
    dDots.forEach((d,i)=>d.classList.toggle('filled', i<player.dash));
  }

  function updateHUD(){
    scoreVal.textContent = Math.floor(score);
    comboVal.textContent = "x"+combo;
  }

  // ===== Input
  const keys = {};
  addEventListener('keydown', e=>{
    if(['ArrowLeft','ArrowRight','ArrowUp','Space','KeyA','KeyD','KeyW'].includes(e.code)) e.preventDefault();
    keys[e.code]=true;
    if(state===STATE.RUN){
      if(e.code==='ArrowLeft'||e.code==='KeyA') lane(-1);
      if(e.code==='ArrowRight'||e.code==='KeyD') lane(+1);
      if(e.code==='ArrowUp'||e.code==='KeyW'||e.code==='Space') doDash();
    }
  });
  addEventListener('keyup', e=> keys[e.code]=false);

  // Touch gestures
  let touchStart=null;
  cvs.addEventListener('touchstart', e=>{
    if(state!==STATE.RUN) return;
    touchStart = [...e.changedTouches][0];
  }, {passive:true});
  cvs.addEventListener('touchmove', e=>{},{passive:true});
  cvs.addEventListener('touchend', e=>{
    if(state!==STATE.RUN||!touchStart) return;
    const t=[...e.changedTouches][0];
    const dx=t.clientX - touchStart.clientX, dy=t.clientY - touchStart.clientY;
    const ax=Math.abs(dx), ay=Math.abs(dy);
    if(Math.max(ax,ay) < 22) { /* tap ignored */ }
    else if(ax>ay){ // horizontal
      if(dx>0) lane(+1); else lane(-1);
    }else{ // vertical
      if(dy<0) doDash();
    }
    touchStart=null;
  }, {passive:true});

  function lane(dir){
    player.targetLane = clamp(player.targetLane + dir, 0, 2);
    beep(800, .05, 'triangle', .06);
  }

  function doDash(){
    if(player.dash<=0 || player.dashCD>0) return;
    player.dash--;
    refreshDashDots();
    player.inv = 400; // ms invincible
    player.dashCD = 600; // ms cooldown before next dash
    timeScale = .5; // slow-mo
    setTimeout(()=> timeScale=1, 250);
    // trail particles
    for(let i=0;i<10;i++) particles.push(makePart(player.x, player.y, '#7df', 140));
    beep(1800, .08, 'sawtooth', .08);
  }

  // UI buttons
  pauseBtn.addEventListener('click', ()=>{
    if(state!==STATE.RUN){ return; }
    state=STATE.PAUSE; setToast('Duraklatƒ±ldƒ±');
  });
  muteBtn.addEventListener('click', ()=>{
    audioOn=!audioOn; muteBtn.textContent = audioOn ? 'üîà' : 'üîá';
    if(audioOn) beep(880, .06, 'square', .06);
  });
  startBtn.addEventListener('click', startGame);
  retryBtn.addEventListener('click', startGame);
  shareBtn.addEventListener('click', async ()=>{
    const txt=`Tango Neo skor: ${Math.floor(score)} | En iyi: ${best}`;
    if(navigator.share){ try{ await navigator.share({title:'Tango Neo', text:txt}); }catch{} }
    else { navigator.clipboard?.writeText(txt); setToast('Panoya kopyalandƒ±'); }
  });
  howBtn.addEventListener('click', ()=>{ hide(menu); show(how); });
  backBtn.addEventListener('click', ()=>{ hide(how); show(menu); });

  addEventListener('visibilitychange', ()=>{ if(document.hidden && state===STATE.RUN){ state=STATE.PAUSE; } });

  // Pause -> Run toggle via click on pauseBtn when paused
  addEventListener('keydown', e=>{
    if(e.code==='Escape'){
      if(state===STATE.RUN){ state=STATE.PAUSE; setToast('Duraklatƒ±ldƒ±'); }
      else if(state===STATE.PAUSE){ state=STATE.RUN; lastT=now(); setToast('Devam'); }
    }
  });

  function startGame(){
    hide(menu); hide(over); hide(how);
    state = STATE.RUN; reset(); lastT = now();
  }

  // ===== Entities
  function makeObstacle(){
    const laneIdx = Math.floor(rand(0,3));
    const size = rand(26, 40);
    return { type:'obs', lane: laneIdx, x: W*lanes[laneIdx], y: -50, w:size, h:size, hit:false, col:'#f77' };
  }
  function makeOrb(){
    const laneIdx = Math.floor(rand(0,3));
    return { type:'orb', lane: laneIdx, x: W*lanes[laneIdx], y: -30, r: 10, t: 0, col:'#7dffa8' };
  }
  function makePart(x,y,color,life=500){
    return {x,y,vx: rand(-60,60), vy: rand(-120,-20), g: 200, a:1, color, life, born: now()};
  }

  // ===== Loop
  let lastT = now();
  function loop(t){
    requestAnimationFrame(loop);
    const dtRaw = (t - lastT) / 1000;
    lastT = t;
    const dt = clamp(dtRaw * timeScale, 0, 0.05); // anti spiral

    if(state===STATE.RUN) update(dt);
    draw();
  }
  requestAnimationFrame(loop);

  function update(dt){
    // difficulty curve
    baseSpeed += dt * 2.2; // slowly increases
    const speed = baseSpeed;

    // spawn timers
    spawnT -= dt; if(spawnT<=0){
      objects.push(makeObstacle());
      // ensure no double collision spawn: small offset spacing
      spawnT = rand(0.55, 0.95);
    }
    orbT -= dt; if(orbT<=0){
      orbs.push(makeOrb());
      orbT = rand(0.6, 1.1);
    }

    // move obstacles & orbs
    for(const o of objects) o.y += speed*dt;
    for(const b of orbs){ b.y += (speed*0.95)*dt; b.t += dt; }

    // cleanup
    objects = objects.filter(o=>o.y < H+60);
    orbs    = orbs.filter(o=>o.y < H+40);

    // player lane lerp
    player.x = lerp(player.x, W*lanes[player.targetLane], 1 - Math.pow(0.0001, dt*60));

    // timers
    if(player.inv>0) player.inv -= dt*1000;
    if(player.dashCD>0){
      const before = Math.ceil(player.dashCD/200);
      player.dashCD -= dt*1000;
      const after = Math.ceil(Math.max(0,player.dashCD)/200);
      if(after<before && player.dash<player.dashMax){
        player.dash++;
        refreshDashDots();
        beep(1100, .04, 'triangle', .05);
      }
    }
    if(comboT>0){ comboT-=dt; if(comboT<=0){ combo = 1; } }

    // scoring passive
    score += dt * 5 * combo;

    // collisions
    // player box
    const pb = {x:player.x - player.w/2, y:player.y - player.h/2, w:player.w, h:player.h};

    // orbs
    for(let i=orbs.length-1;i>=0;i--){
      const o=orbs[i];
      if(o.lane===player.targetLane && Math.abs(o.y - player.y) < (player.h/2 + 14)){
        // collect
        orbs.splice(i,1);
        combo = Math.min(10, combo+1); comboT = 3.5; // seconds to maintain
        score += 10*combo;
        for(let k=0;k<12;k++) particles.push(makePart(o.x, o.y, '#7dffa8', 420));
        beep(1200 + combo*40, .05, 'sine', .06);
        setToast('Combo x'+combo, 600);
      }
    }

    // obstacles
    for(let i=objects.length-1;i>=0;i--){
      const o=objects[i];
      if(aabb(pb, {x:o.x-o.w/2, y:o.y-o.h/2, w:o.w, h:o.h})){
        if(player.inv>0){
          // smash through
          for(let k=0;k<18;k++) particles.push(makePart(o.x, o.y, '#aef', 500));
          objects.splice(i,1);
          score += 6*combo;
          beep(900, .03, 'square', .07);
        }else{
          gameOver();
          return;
        }
      }
    }
  }

  function aabb(a,b){ return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y; }

  function draw(){
    // bg
    ctx.clearRect(0,0,W,H);
    // moving road gradient
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, '#0b1028'); g.addColorStop(1, '#070b19');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

    // horizon glow
    ctx.save();
    const grd = ctx.createRadialGradient(W/2, H*0.2, 10, W/2, H*0.2, 220);
    grd.addColorStop(0, 'rgba(109,230,255,0.25)');
    grd.addColorStop(1, 'rgba(109,230,255,0)');
    ctx.fillStyle = grd; ctx.fillRect(0,0,W,H*0.6);
    ctx.restore();

    // lanes (subtle)
    ctx.strokeStyle='rgba(255,255,255,0.06)';
    ctx.lineWidth=2;
    for(let i=0;i<3;i++){
      const x=W*lanes[i];
      ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke();
    }

    // orbs
    for(const b of orbs){
      ctx.save();
      ctx.shadowColor='rgba(125,255,168,0.6)'; ctx.shadowBlur=12;
      ctx.fillStyle='#7dffa8';
      ctx.beginPath(); ctx.arc(b.x, b.y, b.r + Math.sin(b.t*6)*1.8, 0, Math.PI*2); ctx.fill();
      ctx.restore();
    }

    // obstacles
    for(const o of objects){
      ctx.save();
      ctx.fillStyle='#2b314f';
      roundRect(o.x-o.w/2, o.y-o.h/2, o.w, o.h, 6);
      ctx.fill();
      ctx.strokeStyle='rgba(255,107,107,0.9)'; ctx.lineWidth=2; roundRect(o.x-o.w/2, o.y-o.h/2, o.w, o.h, 6); ctx.stroke();
      ctx.restore();
    }

    // player
    ctx.save();
    const invPhase = player.inv>0 ? (Math.sin(performance.now()*0.04)>0?0.5:1) : 1;
    ctx.globalAlpha = invPhase;
    // capsule body
    ctx.translate(player.x, player.y);
    const pw = player.w, ph = player.h;
    const r = 10;
    ctx.fillStyle='#cfe8ff';
    roundRect(-pw/2, -ph/2, pw, ph, r); ctx.fill();
    // accents
    ctx.strokeStyle='rgba(109,230,255,0.9)'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(-pw/2+6,0); ctx.lineTo(pw/2-6,0); ctx.stroke();
    ctx.restore();

    // particles
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i], life = (now()-p.born);
      const t = clamp(life/p.life, 0, 1);
      p.vy += p.g*(1/60); p.x += p.vx*(1/60); p.y += p.vy*(1/60);
      p.a = 1-t;
      if(life>p.life) { particles.splice(i,1); continue; }
      ctx.globalAlpha = p.a; ctx.fillStyle=p.color;
      ctx.fillRect(p.x, p.y, 2, 2);
      ctx.globalAlpha = 1;
    }

    // state overlays
    if(state===STATE.PAUSE){
      drawOverlay('Duraklatƒ±ldƒ±', 'Devam etmek i√ßin ESC veya ‚è∏');
    }else if(state===STATE.MENU){
      // UI handles
    }else if(state===STATE.OVER){
      // UI handles
    }
  }

  function roundRect(x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr,y);
    ctx.arcTo(x+w,y,x+w,y+h,rr);
    ctx.arcTo(x+w,y+h,x,y+h,rr);
    ctx.arcTo(x,y+h,x,y,rr);
    ctx.arcTo(x,y,x+w,y,rr);
    ctx.closePath();
  }

  function drawOverlay(title, hint){
    ctx.save();
    ctx.fillStyle='rgba(0,0,0,0.35)';
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle='#e9ecff'; ctx.textAlign='center';
    ctx.font='700 28px system-ui, sans-serif'; ctx.fillText(title, W/2, H/2-10);
    ctx.font='14px system-ui, sans-serif'; ctx.globalAlpha=.85; ctx.fillText(hint, W/2, H/2+18);
    ctx.restore();
  }

  function gameOver(){
    state = STATE.OVER;
    finalScore.textContent = Math.floor(score);
    if(score>best){ best = Math.floor(score); localStorage.setItem('tango_best_v2', best); }
    bestScore.textContent = best; bestVal.textContent = best;
    show(over);
    beep(240, .18, 'sawtooth', .07);
  }

  // ===== Init world arrays
  objects=[]; orbs=[]; particles=[];

  // Start in menu
  show(menu);

})();
</script>
</body>
</html>