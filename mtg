<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tango — Neo / NeoKlasik / Klasik</title>
<style>
  :root{
    /* Varsayılan (Neo) — JS ile değişecek */
    --bg:#0f1220; --panel:#171a2b; --text:#e6e7ee; --muted:#9aa0b6;
    --accent:#7dd3fc; --accent2:#a78bfa; --glass:rgba(255,255,255,.06);
    --shadow:0 8px 24px rgba(0,0,0,.35); --radius:14px;
    --grid-line:rgba(255,255,255,.06); --grid-bg1:rgba(255,255,255,.05); --grid-bg2:rgba(255,255,255,.01);
    --block-border:rgba(255,255,255,.25);
    --block-flat:#9bdcff; --block-flat2:#6aa0ff; --glow:rgba(125,211,252,1);
  }
  html,body{
    margin:0;height:100%;
    background: radial-gradient(1200px 800px at 70% -10%, #22284a 0%, #101428 35%, #0b0e1d 60%, #080a17 100%), var(--bg);
    color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    overflow:hidden;
  }
  #wrap{position:relative; width:100%; height:100%;}
  canvas{display:block; width:100%; height:100%;}
  .hud{
    position:absolute; inset:16px 16px auto 16px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    padding:10px 12px; background:var(--glass); backdrop-filter: blur(6px); border-radius:var(--radius); box-shadow: var(--shadow); border:1px solid rgba(255,255,255,.08);
  }
  .stat{font-weight:600; letter-spacing:.2px;}
  .muted{color:var(--muted)}
  .chip{padding:6px 10px; border-radius:999px; background:rgba(125,211,252,.15); border:1px solid rgba(125,211,252,.35)}
  .btn{
    cursor:pointer; user-select:none;
    padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12);
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    box-shadow: var(--shadow); transition: transform .06s ease;
  }
  .btn:active{ transform: translateY(1px) scale(.99); }
  .footer{
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:16px; padding:8px 12px; font-size:12px; color:var(--muted);
    background:var(--glass); border:1px solid rgba(255,255,255,.08); border-radius:999px; backdrop-filter: blur(6px);
  }
  .centerNote{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    padding:14px 18px; background:var(--glass); border:1px solid rgba(255,255,255,.08);
    border-radius:var(--radius); text-align:center; box-shadow: var(--shadow);
  }
  .toolbar{
    position:absolute; right:16px; top:16px; display:flex; gap:10px; align-items:center;
    padding:10px 12px; background:var(--glass); backdrop-filter: blur(6px); border-radius:var(--radius); border:1px solid rgba(255,255,255,.08);
  }
  select{
    appearance:none; padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text);
  }
</style>
</head>
<body>
<div id="wrap">
  <canvas id="game"></canvas>

  <div class="hud" id="hud">
    <div class="stat">Skor: <span id="score">0</span></div>
    <div class="stat muted">•</div>
    <div class="stat">En İyi: <span id="best">0</span></div>
    <div class="chip" id="fps">FPS</div>
    <div class="btn" id="pauseBtn" title="P / Space">Duraklat</div>
    <div class="btn" id="restartBtn" title="R">Yeniden Başlat</div>
  </div>

  <div class="toolbar">
    Tema:
    <select id="themeSel">
      <option value="neo">Neo</option>
      <option value="neoklasik">NeoKlasik</option>
      <option value="klasik">Klasik</option>
    </select>
  </div>

  <div class="footer">←/→: hareket • ↑/Space: hızlı düşür • P: duraklat • R: restart</div>
  <div class="centerNote" id="centerNote" style="display:none;">Duraklatıldı</div>
</div>

<script>
/* ===================== TEMALAR ===================== */
const THEMES = {
  neo:{
    vars:{
      '--bg':'#0f1220','--panel':'#171a2b','--text':'#e6e7ee','--muted':'#9aa0b6',
      '--accent':'#7dd3fc','--accent2':'#a78bfa','--glass':'rgba(255,255,255,.06)',
      '--grid-line':'rgba(255,255,255,.06)','--grid-bg1':'rgba(255,255,255,.05)','--grid-bg2':'rgba(255,255,255,.01)',
      '--block-border':'rgba(255,255,255,.25)','--block-flat':'#9bdcff','--block-flat2':'#6aa0ff','--glow':'rgba(125,211,252,1)'
    },
    blockStyle:'gradientGlow', gridStyle:'softPanel', bg:'dynamicGlow'
  },
  neoklasik:{
    vars:{
      '--bg':'#0e1117','--panel':'#121622','--text':'#e9eef5','--muted':'#a0a8bd',
      '--accent':'#8bd3ff','--accent2':'#c5b7ff','--glass':'rgba(255,255,255,.05)',
      '--grid-line':'rgba(255,255,255,.08)','--grid-bg1':'rgba(255,255,255,.04)','--grid-bg2':'rgba(255,255,255,.015)',
      '--block-border':'rgba(255,255,255,.18)','--block-flat':'#8dc5ff','--block-flat2':'#7b9bff','--glow':'rgba(180,200,255,1)'
    },
    blockStyle:'softGradient', gridStyle:'panelLines', bg:'subtleGlow'
  },
  klasik:{
    vars:{
      '--bg':'#0a0a0a','--panel':'#101010','--text':'#eaeaea','--muted':'#b0b0b0',
      '--accent':'#f0f0f0','--accent2':'#cccccc','--glass':'rgba(255,255,255,.04)',
      '--grid-line':'rgba(255,255,255,.15)','--grid-bg1':'rgba(255,255,255,.02)','--grid-bg2':'rgba(255,255,255,.0)',
      '--block-border':'rgba(0,0,0,.6)','--block-flat':'#e2e2e2','--block-flat2':'#bdbdbd','--glow':'rgba(255,255,255,1)'
    },
    blockStyle:'flatBorder', gridStyle:'hardLines', bg:'none'
  }
};

function applyTheme(key){
  const t = THEMES[key] || THEMES.neo;
  const root = document.documentElement;
  for(const k in t.vars) root.style.setProperty(k, t.vars[k]);
  localStorage.setItem('tango_theme', key);
  currentTheme=key;
}

/* ===================== OYUN MOTORU ===================== */
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const hud = {
    score: document.getElementById('score'),
    best:  document.getElementById('best'),
    fps:   document.getElementById('fps'),
    pauseBtn: document.getElementById('pauseBtn'),
    restartBtn: document.getElementById('restartBtn'),
    centerNote: document.getElementById('centerNote')
  };
  const themeSel = document.getElementById('themeSel');

  let currentTheme = localStorage.getItem('tango_theme') || 'neo';
  themeSel.value = currentTheme;
  applyTheme(currentTheme);
  themeSel.addEventListener('change', ()=>applyTheme(themeSel.value));

  // Ekran / DPR
  const state = { width:0, height:0, dpr:1, running:true, last:0, acc:0, fps:0, score:0, best:Number(localStorage.getItem('tango_best')||0) };
  hud.best.textContent = state.best;

  function resize(){
    const {clientWidth:w, clientHeight:h} = canvas.parentElement;
    const dpr = Math.min(window.devicePixelRatio||1, 2);
    canvas.width = Math.floor(w*dpr);
    canvas.height = Math.floor(h*dpr);
    canvas.style.width = w+'px'; canvas.style.height = h+'px';
    ctx.setTransform(dpr,0,0,dpr,0,0);
    state.width=w; state.height=h; state.dpr=dpr;
    centerGrid();
  }
  addEventListener('resize', resize, {passive:true}); resize();

  // Grid / pano
  const GRID = { cols:10, rows:18, cell:36, originX:0, originY:0 };
  function centerGrid(){
    const w = GRID.cols*GRID.cell, h = GRID.rows*GRID.cell;
    GRID.originX = Math.floor(state.width/2 - w/2);
    GRID.originY = Math.floor(state.height/2 - h/2);
  }
  const board = Array.from({length:GRID.rows},()=>Array(GRID.cols).fill(0));

  // Giriş
  const input = { left:false, right:false, up:false };
  addEventListener('keydown', e=>{
    if(e.code==='ArrowLeft'||e.code==='KeyA') input.left=true;
    if(e.code==='ArrowRight'||e.code==='KeyD') input.right=true;
    if(['ArrowUp','KeyW','Space'].includes(e.code)) input.up=true;
    if(e.code==='KeyP') togglePause();
    if(e.code==='KeyR') restart();
  });
  addEventListener('keyup', e=>{
    if(e.code==='ArrowLeft'||e.code==='KeyA') input.left=false;
    if(e.code==='ArrowRight'||e.code==='KeyD') input.right=false;
    if(['ArrowUp','KeyW','Space'].includes(e.code)) input.up=false;
  });
  // dokunmatik: sol/sağ
  addEventListener('touchstart', e=>{
    const x = e.changedTouches[0].clientX;
    if(x < state.width/2) input.left=true; else input.right=true;
  },{passive:true});
  addEventListener('touchend', ()=>{ input.left=false; input.right=false; input.up=true; },{passive:true});

  hud.pauseBtn.addEventListener('click', togglePause);
  hud.restartBtn.addEventListener('click', restart);

  function togglePause(){
    state.running = !state.running;
    hud.centerNote.textContent = state.running ? '' : 'Duraklatıldı';
    hud.centerNote.style.display = state.running ? 'none' : 'block';
  }

  // Şekiller
  const SHAPES = [
    [[1,1,1,1]],
    [[1,1],[1,1]],
    [[0,1,0],[1,1,1]],
    [[1,0,0],[1,1,1]],
    [[0,0,1],[1,1,1]],
    [[1,1,0],[0,1,1]],
    [[0,1,1],[1,1,0]]
  ];

  function newPiece(){
    const shape = SHAPES[Math.floor(Math.random()*SHAPES.length)];
    const w = shape[0].length, h = shape.length;
    return {
      x: Math.floor(GRID.cols/2 - w/2),
      y: -h,
      shape,
      fallTimer: 0,
      fallRate: 0.6,
      c1: `hsl(${Math.floor(Math.random()*120+180)} 90% 65%)`,
      c2: `hsl(${Math.floor(Math.random()*120+180)} 90% 55%)`
    };
  }
  let piece = newPiece(), gameOver=false;

  function collide(px,py,shape){
    for(let r=0;r<shape.length;r++) for(let c=0;c<shape[r].length;c++){
      if(!shape[r][c]) continue;
      const x=px+c, y=py+r;
      if(x<0||x>=GRID.cols||y>=GRID.rows) return true;
      if(y>=0 && board[y][x]) return true;
    }
    return false;
  }

  function lockPiece(){
    const {x:px,y:py,shape} = piece;
    for(let r=0;r<shape.length;r++) for(let c=0;c<shape[r].length;c++){
      if(!shape[r][c]) continue;
      const x=px+c, y=py+r; if(y>=0) board[y][x]=1;
    }
    clearLines();
    piece = newPiece();
    if(collide(piece.x,piece.y,piece.shape)){ gameOver=true; showCenter('Oyun Bitti • Space ile yeniden başla'); }
  }

  // Skor/temizleme/partikül
  const particles=[];
  function addScore(n){
    state.score += n; hud.score.textContent = state.score;
    if(state.score>state.best){ state.best=state.score; hud.best.textContent=state.best; localStorage.setItem('tango_best', state.best); }
  }
  function clearLines(){
    let cleared=0;
    for(let r=GRID.rows-1;r>=0;r--){
      if(board[r].every(v=>v===1)){
        board.splice(r,1); board.unshift(Array(GRID.cols).fill(0)); cleared++; spawnClearParticles(r); r++;
      }
    }
    if(cleared){ addScore(cleared===1?100: cleared===2?250: cleared===3?450:700); }
  }
  function spawnClearParticles(row){
    const y = GRID.originY + row*GRID.cell + GRID.cell/2;
    for(let i=0;i<80;i++){
      particles.push({ x: GRID.originX + Math.random()*GRID.cols*GRID.cell, y, vx:(Math.random()*240-120), vy:(-240-Math.random()*120), life:.4+Math.random()*.5, age:0, size:2+Math.random()*3 });
    }
  }
  function updateParticles(dt){
    for(const p of particles){ p.age+=dt; p.vy += 900*dt; p.x += p.vx*dt; p.y += p.vy*dt; }
    for(let i=particles.length-1;i>=0;i--) if(particles[i].age>particles[i].life) particles.splice(i,1);
  }
  function drawParticles(g){
    g.save(); g.globalCompositeOperation='lighter';
    for(const p of particles){ const a=1-(p.age/p.life); g.globalAlpha=a; g.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent')||'#7dd3fc'; g.fillRect(p.x,p.y,p.size,p.size); }
    g.restore(); g.globalAlpha=1;
  }

  // Arka plan
  function drawBG(g){
    const w=state.width, h=state.height;
    const key = localStorage.getItem('tango_theme')||'neo';
    if(THEMES[key].bg==='dynamicGlow'){
      const t = performance.now()*0.0004; const cx=w*(0.5+Math.sin(t)*0.2); const cy=h*(0.4+Math.cos(t*0.9)*0.15); const rad = Math.max(w,h)*0.8;
      const grd = g.createRadialGradient(cx,cy,rad*0.1, cx,cy,rad);
      grd.addColorStop(0, 'rgba(167,139,250,.12)'); grd.addColorStop(1,'rgba(0,0,0,0)');
      g.fillStyle=grd; g.fillRect(0,0,w,h);
    } else if(THEMES[key].bg==='subtleGlow'){
      const grd = g.createRadialGradient(w*.7,h*.2,10, w*.7,h*.2,Math.max(w,h)*.7);
      grd.addColorStop(0,'rgba(200,220,255,.08)'); grd.addColorStop(1,'rgba(0,0,0,0)');
      g.fillStyle=grd; g.fillRect(0,0,w,h);
    }
  }

  // Çizim yardımcıları
  function drawRoundedRect(g,x,y,w,h,r=8){ g.beginPath(); g.moveTo(x+r,y); g.arcTo(x+w,y,x+w,y+h,r); g.arcTo(x+w,y+h,x,y+h,r); g.arcTo(x,y+h,x,y,r); g.arcTo(x,y,x+w,y,r); g.closePath(); }
  function fillGradient(g,x,y,w,h,c1,c2){ const grad=g.createLinearGradient(x,y,x+w,y+h); grad.addColorStop(0,c1); grad.addColorStop(1,c2); g.fillStyle=grad; g.fill(); }
  function drawGlow(g,x,y,w,h,alpha){ g.save(); g.shadowColor=getComputedStyle(document.documentElement).getPropertyValue('--glow')||'rgba(125,211,252,1)'; g.shadowBlur=30*alpha; g.globalAlpha=.9*alpha; drawRoundedRect(g,x,y,w,h,10); g.fillStyle='rgba(125,211,252,.15)'; g.fill(); g.restore(); g.globalAlpha=1; }

  // Grid çizimi
  function drawGrid(g){
    const ox=GRID.originX, oy=GRID.originY, cs=GRID.cell, w=GRID.cols*cs, h=GRID.rows*cs;
    const key = localStorage.getItem('tango_theme')||'neo';
    // pano
    drawRoundedRect(g, ox-10, oy-10, w+20, h+20, 16);
    if(THEMES[key].gridStyle==='softPanel'){
      fillGradient(g, ox-10, oy-10, w+20, h+20, getVar('--grid-bg1'), getVar('--grid-bg2')); drawGlow(g,ox-10,oy-10,w+20,h+20,.6);
    } else if(THEMES[key].gridStyle==='panelLines'){
      fillGradient(g, ox-10, oy-10, w+20, h+20, getVar('--grid-bg1'), getVar('--grid-bg2'));
    } else {
      // klasik: düz panel
      g.fillStyle='rgba(255,255,255,.04)'; g.fill();
    }
    // ızgara çizgileri
    g.save(); g.strokeStyle=getVar('--grid-line'); g.lineWidth=1;
    for(let c=0;c<=GRID.cols;c++){ const x=ox+c*cs; g.beginPath(); g.moveTo(x,oy); g.lineTo(x,oy+h); g.stroke(); }
    for(let r=0;r<=GRID.rows;r++){ const y=oy+r*cs; g.beginPath(); g.moveTo(ox,y); g.lineTo(ox+w,y); g.stroke(); }
    g.restore();

    // yerleşik bloklar
    for(let r=0;r<GRID.rows;r++) for(let c=0;c<GRID.cols;c++){
      if(board[r][c]) drawBlock(g, ox+c*cs, oy+r*cs, cs, cs, key, '#93c5fd','#a78bfa');
    }
  }

  function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

  function drawBlock(g,x,y,w,h, themeKey, c1, c2){
    const style = THEMES[themeKey].blockStyle;
    const pad=3, r=8;
    drawRoundedRect(g, x+pad, y+pad, w-pad*2, h-pad*2, r);
    if(style==='gradientGlow'){
      fillGradient(g, x+pad, y+pad, w-pad*2, h-pad*2, c1, c2);
      drawGlow(g, x+pad, y+pad, w-pad*2, h-pad*2, .5);
      // ince çerçeve
      g.save(); g.globalAlpha=.35; g.strokeStyle=getVar('--block-border'); g.lineWidth=1; g.stroke(); g.restore();
    } else if(style==='softGradient'){
      fillGradient(g, x+pad, y+pad, w-pad*2, h-pad*2, c1, c2);
      g.save(); g.globalAlpha=.25; g.strokeStyle=getVar('--block-border'); g.lineWidth=1; g.stroke(); g.restore();
    } else { // flatBorder
      g.fillStyle = getVar('--block-flat'); g.fill();
      g.save(); g.strokeStyle=getVar('--block-border'); g.lineWidth=2; g.stroke(); g.restore();
      // hafif üst parlama
      g.save(); g.globalAlpha=.08; g.fillStyle='#fff'; drawRoundedRect(g,x+pad,y+pad,(w-pad*2),(h-pad*2)/2,r); g.fill(); g.restore();
    }
  }

  // Aktif taş
  function drawPiece(g){
    const ox=GRID.originX, oy=GRID.originY, cs=GRID.cell;
    const key = localStorage.getItem('tango_theme')||'neo';
    for(let r=0;r<piece.shape.length;r++) for(let c=0;c<piece.shape[r].length;c++){
      if(!piece.shape[r][c]) continue;
      drawBlock(g, ox+(piece.x+c)*cs, oy+(piece.y+r)*cs, cs, cs, key, piece.c1, piece.c2);
    }
    // hayalet
    g.save(); g.globalAlpha=.15;
    let py=piece.y; while(!collide(piece.x,py+1,piece.shape)) py++;
    for(let r=0;r<piece.shape.length;r++) for(let c=0;c<piece.shape[r].length;c++){
      if(!piece.shape[r][c]) continue;
      drawBlock(g, ox+(piece.x+c)*cs, oy+(py+r)*cs, cs, cs, key, '#ffffff','#ffffff');
    }
    g.restore();
  }

  // Oyun akışı
  function update(dt){
    if(!gameOver){
      if(input.left && !collide(piece.x-1,piece.y,piece.shape)) { piece.x--; input.left=false; }
      if(input.right&& !collide(piece.x+1,piece.y,piece.shape)) { piece.x++; input.right=false; }
      if(input.up){
        while(!collide(piece.x,piece.y+1,piece.shape)){ piece.y++; addScore(1); }
        lockPiece(); input.up=false;
      }
      piece.fallTimer += dt;
      const rate = Math.max(0.15, piece.fallRate - Math.min(0.4, state.score/5000));
      if(piece.fallTimer>=rate){
        piece.fallTimer=0;
        if(!collide(piece.x,piece.y+1,piece.shape)) piece.y++;
        else lockPiece();
      }
    }
    updateParticles(dt);
  }

  function draw(){
    ctx.clearRect(0,0,state.width,state.height);
    drawBG(ctx);
    drawGrid(ctx);
    drawPiece(ctx);
    drawParticles(ctx);
  }

  function showCenter(msg){ hud.centerNote.textContent=msg; hud.centerNote.style.display='block'; }
  function hideCenter(){ hud.centerNote.style.display='none'; }
  function restart(){
    for(let r=0;r<GRID.rows;r++) for(let c=0;c<GRID.cols;c++) board[r][c]=0;
    piece=newPiece(); state.score=0; hud.score.textContent=0; particles.length=0; gameOver=false; hideCenter();
  }

  const FIXED=1/60;
  function loop(t){
    const ts=t*0.001; const dtRaw=state.last? (ts-state.last):FIXED; state.last=ts;
    state.fps = Math.round(1/Math.max(0.001, dtRaw)); hud.fps.textContent = state.fps+' FPS';
    if(state.running){
      state.acc += dtRaw; let steps=0; while(state.acc>=FIXED && steps<5){ update(FIXED); state.acc-=FIXED; steps++; }
      draw();
    }
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // Space ile restart
  addEventListener('keydown', e=>{ if(gameOver && (e.code==='Space'||e.code==='Enter')) restart(); });

})();
</script>
</body>
</html>